// Prisma schema for Medical Voice Assistant

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Doctors table
model Doctor {
  id              Int       @id @default(autoincrement())
  name            String    @db.VarChar(255)
  specialty       String    @db.VarChar(100)
  experienceYears Int?      @map("experience_years")
  bio             String?   @db.Text
  photoUrl        String?   @map("photo_url") @db.VarChar(500)
  phone           String?   @db.VarChar(20)
  email           String?   @db.VarChar(255)
  isActive        Boolean   @default(true) @map("is_active")
  createdAt       DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt       DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)

  schedules    DoctorSchedule[]
  timeSlots    TimeSlot[]
  appointments Appointment[]

  @@map("doctors")
}

// Doctor schedules
model DoctorSchedule {
  id          Int      @id @default(autoincrement())
  doctorId    Int      @map("doctor_id")
  dayOfWeek   Int      @map("day_of_week") // 0 = Sunday, 1 = Monday, etc.
  startTime   DateTime @map("start_time") @db.Time(6)
  endTime     DateTime @map("end_time") @db.Time(6)
  isAvailable Boolean  @default(true) @map("is_available")
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamp(6)

  doctor Doctor @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  @@map("doctor_schedules")
}

// Time slots for appointments
model TimeSlot {
  id              Int      @id @default(autoincrement())
  doctorId        Int      @map("doctor_id")
  slotDate        DateTime @map("slot_date") @db.Date
  slotTime        DateTime @map("slot_time") @db.Time(6)
  isBooked        Boolean  @default(false) @map("is_booked")
  durationMinutes Int      @default(30) @map("duration_minutes")
  createdAt       DateTime @default(now()) @map("created_at") @db.Timestamp(6)

  doctor       Doctor        @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  appointments Appointment[]

  @@unique([doctorId, slotDate, slotTime])
  @@map("time_slots")
}

// Patients table
model Patient {
  id             Int      @id @default(autoincrement())
  name           String?  @db.VarChar(255)
  phone          String?  @unique @db.VarChar(20)
  email          String?  @db.VarChar(255)
  dateOfBirth    DateTime? @map("date_of_birth") @db.Date
  address        String?  @db.Text
  medicalHistory String?  @map("medical_history") @db.Text
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt      DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)

  appointments   Appointment[]
  consultations  Consultation[]

  @@map("patients")
}

// Appointments table
model Appointment {
  id              Int      @id @default(autoincrement())
  patientId       Int?     @map("patient_id")
  doctorId        Int      @map("doctor_id")
  timeSlotId      Int      @map("time_slot_id")
  appointmentDate DateTime @map("appointment_date") @db.Date
  appointmentTime DateTime @map("appointment_time") @db.Time(6)
  status          String   @default("scheduled") @db.VarChar(50) // scheduled, confirmed, completed, cancelled, no_show
  symptoms        String?  @db.Text
  notes           String?  @db.Text
  createdAt       DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt       DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)

  patient  Patient?  @relation(fields: [patientId], references: [id], onDelete: SetNull)
  doctor   Doctor    @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  timeSlot TimeSlot  @relation(fields: [timeSlotId], references: [id], onDelete: Cascade)

  @@map("appointments")
}

// Consultations history
model Consultation {
  id                  Int      @id @default(autoincrement())
  patientId           Int?     @map("patient_id")
  symptoms            String   @db.Text
  aiResponse          String?  @map("ai_response") @db.Text
  recommendedSpecialty String? @map("recommended_specialty") @db.VarChar(100)
  severityLevel       String?  @map("severity_level") @db.VarChar(50) // low, medium, high, emergency
  createdAt           DateTime @default(now()) @map("created_at") @db.Timestamp(6)

  patient Patient? @relation(fields: [patientId], references: [id], onDelete: SetNull)

  @@map("consultations")
}

// Emergency calls
model EmergencyCall {
  id              Int      @id @default(autoincrement())
  patientName     String?  @map("patient_name") @db.VarChar(255)
  phone           String?  @db.VarChar(20)
  description     String   @db.Text
  location        String?  @db.Text
  status          String   @default("pending") @db.VarChar(50) // pending, dispatched, completed
  priority        String   @default("high") @db.VarChar(50) // low, medium, high, critical
  dispatcherNotes String?  @map("dispatcher_notes") @db.Text
  createdAt       DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt       DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)

  @@map("emergency_calls")
}

// Clinic information (FAQ, services, etc.)
model ClinicInfo {
  id           Int      @id @default(autoincrement())
  category     String   @db.VarChar(100) // hours, services, pricing, faq, etc.
  question     String?  @db.Text
  answer       String   @db.Text
  displayOrder Int      @default(0) @map("display_order")
  isActive     Boolean  @default(true) @map("is_active")
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamp(6)

  @@map("clinic_info")
}

// Conversation logs
model ConversationLog {
  id         Int      @id @default(autoincrement())
  sessionId  String?  @map("session_id") @db.VarChar(255)
  userInput  String   @map("user_input") @db.Text
  aiResponse String?  @map("ai_response") @db.Text
  intent     String?  @db.VarChar(100) // appointment, consultation, info, emergency
  metadata   Json?
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamp(6)

  @@map("conversation_logs")
}

// Admin users for authentication
model Admin {
  id           Int      @id @default(autoincrement())
  username     String   @unique @db.VarChar(100)
  email        String   @unique @db.VarChar(255)
  passwordHash String   @map("password_hash") @db.VarChar(255)
  fullName     String?  @map("full_name") @db.VarChar(255)
  role         String   @default("admin") @db.VarChar(50) // admin, super_admin
  isActive     Boolean  @default(true) @map("is_active")
  lastLoginAt  DateTime? @map("last_login_at") @db.Timestamp(6)
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt    DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)

  @@map("admins")
}
